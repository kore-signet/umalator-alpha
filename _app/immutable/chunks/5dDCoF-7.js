import{v as U,G as _t,ba as gt,i as bt,bb as Z,I as yt,K as kt,J as wt,L as V,F as Tt,ak as Y,ac as X,aO as Q,bc as St,ae as xt,bd as Et,be as It,aN as Mt,b8 as Ct,M as Lt,h as At,A as Dt,a4 as zt,bf as Pt,s as E,g as l,a as g,z as nt,p as $,a5 as W,u as ot,a7 as z,a8 as J,a6 as _,a9 as d,aa as c,x as lt,aP as B,bg as tt,ad as D,aS as jt}from"./C6rPX6h7.js";import{m as Nt,u as Ot,e as R,s as I,d as Ut}from"./CXcZAwMN.js";import{f as P,a as M,t as ut,c as Bt}from"./Btt5eB3s.js";import{i as dt,b as q}from"./P4Sub8Du.js";import{c as et,r as Rt,d as Ft,f as Vt,s as Yt,e as st,i as rt}from"./mVNluMtM.js";import{b as Gt}from"./Da30xLQX.js";import{B as Ht}from"./DyeecbTp.js";import{a as ct,b as Xt}from"./DWRUclYQ.js";const it=0,G=1;function qt(i,t,e,s,r){U&&_t();var a=gt(),n=Ct,o=a?X(n):Q(n,!1,!1),f=a?X(n):Q(n,!1,!1),h=new Ht(i);bt(()=>{var b=t(),w=!1;let u=U&&Z(b)===(i.data===yt);if(u&&(kt(wt()),V(!1)),Z(b)){var m=St(),y=!1;const k=p=>{if(!w){y=!0,m(!1),xt.ensure(),U&&V(!1);try{p()}finally{Et(),It||Mt()}}};b.then(p=>{k(()=>{Y(o,p),h.ensure(G,s&&(T=>s(T,o)))})},p=>{k(()=>{if(Y(f,p),h.ensure(G,r&&(T=>r(T,f))),!r)throw f.v})}),U?h.ensure(it,e):Tt(()=>{y||k(()=>{h.ensure(it,e)})})}else Y(o,b),h.ensure(G,s&&(k=>s(k,o)));return u&&V(!0),()=>{w=!0}})}function ft(i,t,e){Lt(()=>{var s=At(()=>t(i,e?.())||{});if(e&&s?.update){var r=!1,a={};Dt(()=>{var n=e();zt(n),r&&Pt(a,n)&&(a=n,s.update(n))}),r=!0}if(s?.destroy)return()=>s.destroy()})}function H(i){if(i===null||typeof i!="object")return!1;const t=Object.getPrototypeOf(i);return t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||Symbol.iterator in i?!1:Symbol.toStringTag in i?Object.prototype.toString.call(i)==="[object Module]":!0}function K(i,t,e=".",s){if(!H(t))return K(i,{},e,s);const r=Object.assign({},t);for(const a in i){if(a==="__proto__"||a==="constructor")continue;const n=i[a];n!=null&&(s&&s(r,a,n,e)||(Array.isArray(n)&&Array.isArray(r[a])?r[a]=[...n,...r[a]]:H(n)&&H(r[a])?r[a]=K(n,r[a],(e?`${e}.`:"")+a.toString(),s):r[a]=n))}return r}function Kt(i){return(...t)=>t.reduce((e,s)=>K(e,s,"",i),{})}const at=Kt();class Wt extends Error{constructor(t,e){super(`No config found for variant '${t}'. Available variants: ${e.join(", ")}`)}}class Jt extends Error{constructor(){super("Stack custom push must have component property specified")}}class Zt{#e=E("idle");get state(){return l(this.#e)}set state(t){g(this.#e,t,!0)}config;#t={msToTimeout:0,timeoutId:void 0,lastStartedTime:new Date().getTime(),resolveListeners:new Set,resolve:()=>{}};resolution;constructor(t){this.config=t,this.#t.msToTimeout=t.timeout,this.resolution=new Promise(e=>{this.#t.resolve=e})}get progress(){if(this.config.timeout===0)return null;if(this.state==="elapsing"){const t=Date.now()-this.#t.lastStartedTime,e=this.#t.msToTimeout-t;return(this.config.timeout-e)/this.config.timeout}return(this.config.timeout-this.#t.msToTimeout)/this.config.timeout}resume=()=>{this.#t.msToTimeout<=0||this.state==="elapsing"||(clearTimeout(this.#t.timeoutId),this.#t.lastStartedTime=new Date().getTime(),this.#t.timeoutId=setTimeout(async()=>{this.#t.msToTimeout=0,await this.resolve(),this.state="timeout"},this.#t.msToTimeout),this.state="elapsing")};pause=()=>{this.state==="paused"||this.state==="idle"||(clearTimeout(this.#t.timeoutId),this.#t.msToTimeout-=new Date().getTime()-this.#t.lastStartedTime,this.state="paused")};resolve=async t=>{if(await nt(),this.state==="resolved"||this.state==="timeout")return this.resolution;let e=!1;function s(){e=!0}if(await Promise.all(Array.from(this.#t.resolveListeners).map(r=>r({resolved:t,cancel:s}))),!e)return this.#t.resolve(t),this.state="resolved",this.resolution};onResolve=t=>(this.#t.resolveListeners.add(t),()=>{this.#t.resolveListeners.delete(t)})}class Qt{#e={};#t=0;#s=E($([]));get items(){return l(this.#s)}set items(t){g(this.#s,t,!0)}#r=E($({id:"uuid",timeout:0}));get config(){return l(this.#r)}set config(t){g(this.#r,t,!0)}actions={render:(t,e)=>{const s=Nt(e.config.component,{target:t,props:{...e.config.props,item:e},intro:!0});return nt().then(()=>{const r={item:e},a=new CustomEvent("stackitemmount",{detail:r});t.dispatchEvent(a)}),{destroy:async()=>{await Ot(s);const r={item:e},a=new CustomEvent("stackitemunmount",{detail:r});t.dispatchEvent(a)}}}};constructor(t,e){e?.id&&(this.config.id=e.id),e?.timeout&&(this.config.timeout=e.timeout||0),this.#e=t}push(t,e){let s;if(t==="custom"){const n=e;if(!n||!n.component)throw new Jt;s=at({variant:"custom"},n,this.config)}else{const n=e,o=this.#e[t];if(!o)throw new Wt(t,Object.keys(this.#e));s=at(n,o,this.config)}let r="";s.id==="counter"?r=(++this.#t).toString():s.id==="uuid"?r="crypto"in globalThis&&crypto.randomUUID?crypto.randomUUID():(++this.#t).toString():r=s.id(s);let a=new Zt({...s,id:r});return a.resolution.then(()=>{this.items=this.items.filter(n=>n.config.id!==a.config.id)}),this.items.push(a),a.resume(),a}pop(t,e){let s;t&&(typeof t=="string"?s=t:{id:s,resolved:e}=t);let r=null;return s?r=this.items.find(a=>a.config.id===s)??null:r=this.items.at(-1)??null,r&&(r.resolve(e),this.items=this.items.filter(a=>a.config.id!==r.config.id)),r}pause(t){t?this.items.find(s=>s.config.id===t)?.pause():this.items.forEach(e=>e.pause())}resume(t){if(!t)this.items.forEach(e=>e.resume());else return this.items.find(s=>s.config.id===t)?.resume()}}class $t{#e={};#t;constructor(t){this.#t=t}addVariant(t,e){return"component"in e?this.#e[t]={...e,variant:t}:this.#e[t]={component:e,variant:t},this}build(){return new Qt(this.#e,this.#t)}}function te(i){return new $t(i)}function vt(i){function t(e){let s=e.target.getBoundingClientRect();!e.clientX||!e.clientY||(s.left>e.clientX||s.right<e.clientX||s.top>e.clientY||s.bottom<e.clientY)&&i.dispatchEvent(new CustomEvent("clickbackdrop"))}return i.addEventListener("click",t),{destroy(){i.removeEventListener("click",t)}}}var ee=P("<br/> <i> </i>",1),se=P('<dialog class="svelte-3m9gln"><form><div class="form-group"><label for="trainerid">Trainer ID (12 digits) <!></label> <input id="trainerid" type="text" inputmode="numeric" pattern="\\d+" minlength="12" maxlength="12"/></div></form> <form method="dialog"><button type="submit">cancel</button> <button type="submit">search</button></form></dialog>');function re(i,t){W(t,!0);let e;function s(){e.open||t.item.resolve({trainer_id:e.returnValue})}ot(()=>{e?.showModal()});let r=E(void 0),a=E(null),n=E(void 0),o={get value(){return l(a)},set value(v){l(r)?.validity?.patternMismatch?g(n,"only numbers allowed!"):l(r)?.validity?.tooShort||l(r)?.validity?.tooLong?g(n,"trainerid must be 12 digits!"):g(n,null),g(a,v,!0)}};var f=se(),h=d(f),b=d(h),w=d(b),u=_(d(w));{var m=v=>{var C=ee(),S=_(lt(C),2),L=d(S,!0);c(S),z(()=>I(L,l(n))),M(v,C)};dt(u,v=>{l(n)&&v(m)})}c(w);var y=_(w,2);Rt(y),q(y,v=>g(r,v),()=>l(r)),c(b),c(h);var k=_(h,2),p=d(k);et(p,null);var T=_(p,2);c(k),c(f),q(f,v=>e=v,()=>e),ft(f,v=>vt?.(v)),z(()=>{Ft(y,1,Vt(l(n)?"border-danger":""),"svelte-3m9gln"),et(T,l(a))}),R("clickbackdrop",f,()=>e.close()),R("animationend",f,s),Gt(y,()=>o.value,v=>o.value=v),M(i,f),J()}async function ie(i){const e=await(await fetch(`https://tracen.cat-girl.gay/public/v1/team?viewer_id=${i}`)).json();let s=new Map;for(const a of e.trained_chara_array)s.set(a.trained_chara_id,a);let r=new Map;for(const a of e.team_data_array){r.has(a.distance_type)||r.set(a.distance_type,{distance:a.distance_type,umas:[]});let n=r.get(a.distance_type),o;switch(a.running_style){case 1:o="Front";break;case 2:o="Pace";break;case 3:o="Late";break;case 4:o="End";break;default:o="Front";break}n.umas.push({member_id:a.member_id,running_style:o,data:s.get(a.trained_chara_id)})}return r}var ae=P('<div class="paper uma-item svelte-1sg63dk"><img class="portrait svelte-1sg63dk"/> <div class="uma-desc svelte-1sg63dk"><div class="buttons-row svelte-1sg63dk"><h4 class="svelte-1sg63dk"><!></h4></div> <table class="stats-table border border-3 svelte-1sg63dk"><thead><tr class="svelte-1sg63dk"><th class="svelte-1sg63dk">SPD</th><th class="svelte-1sg63dk">STA</th><th class="svelte-1sg63dk">PWR</th><th class="svelte-1sg63dk">GUT</th><th class="svelte-1sg63dk">WIT</th></tr></thead><tbody><tr class="svelte-1sg63dk"><td class="svelte-1sg63dk"> </td><td class="svelte-1sg63dk"> </td><td class="svelte-1sg63dk"> </td><td class="svelte-1sg63dk"> </td><td class="svelte-1sg63dk"> </td></tr></tbody></table></div></div>');function ne(i,t){W(t,!0);let e=B(()=>parseInt(t.uma.card_id.toString().slice(0,-2))),s=B(async()=>await ct.get_text(6,l(e))),r=B(()=>`/chara/chr${l(e)}/chr_icon_${l(e)}_${t.uma.card_id}_01.webp`);var a=ae(),n=d(a),o=_(n,2),f=d(o),h=d(f),b=d(h);qt(b,()=>l(s),null,(N,F)=>{var O=ut();z(()=>I(O,l(F))),M(N,O)}),c(h),c(f);var w=_(f,2),u=_(d(w)),m=d(u),y=d(m),k=d(y,!0);c(y);var p=_(y),T=d(p,!0);c(p);var v=_(p),C=d(v,!0);c(v);var S=_(v),L=d(S,!0);c(S);var A=_(S),j=d(A,!0);c(A),c(m),c(u),c(w),c(o),c(a),z(()=>{Yt(n,"src",l(r)),I(k,t.uma.speed),I(T,t.uma.stamina),I(C,t.uma.power),I(L,t.uma.guts),I(j,t.uma.wiz)}),M(i,a),J()}class ht extends Map{#e=new Map;#t=E(0);#s=E(0);#r=tt||-1;constructor(t){if(super(),t){for(var[e,s]of t)super.set(e,s);this.#s.v=super.size}}#i(t){return tt===this.#r?E(t):X(t)}has(t){var e=this.#e,s=e.get(t);if(s===void 0){var r=super.get(t);if(r!==void 0)s=this.#i(0),e.set(t,s);else return l(this.#t),!1}return l(s),!0}forEach(t,e){this.#a(),super.forEach(t,e)}get(t){var e=this.#e,s=e.get(t);if(s===void 0){var r=super.get(t);if(r!==void 0)s=this.#i(0),e.set(t,s);else{l(this.#t);return}}return l(s),super.get(t)}set(t,e){var s=this.#e,r=s.get(t),a=super.get(t),n=super.set(t,e),o=this.#t;if(r===void 0)r=this.#i(0),s.set(t,r),g(this.#s,super.size),D(o);else if(a!==e){D(r);var f=o.reactions===null?null:new Set(o.reactions),h=f===null||!r.reactions?.every(b=>f.has(b));h&&D(o)}return n}delete(t){var e=this.#e,s=e.get(t),r=super.delete(t);return s!==void 0&&(e.delete(t),g(this.#s,super.size),g(s,-1),D(this.#t)),r}clear(){if(super.size!==0){super.clear();var t=this.#e;g(this.#s,0);for(var e of t.values())g(e,-1);D(this.#t),t.clear()}}#a(){l(this.#t);var t=this.#e;if(this.#s.v!==t.size){for(var e of super.keys())if(!t.has(e)){var s=this.#i(0);t.set(e,s)}}for([,s]of this.#e)l(s)}keys(){return l(this.#t),super.keys()}values(){return this.#a(),super.values()}entries(){return this.#a(),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return l(this.#s),super.size}}function x(i){return["","G","F","E","D","C","B","A","S"][i]}async function oe(i,t,e){let s=parseInt(i.card_id.toString().slice(0,-2)),r=await ct.get_text(6,s),a=new ht(i.skill_array.map(n=>[n.skill_id,structuredClone(Xt.BY_ID.get(n.skill_id).data)]));return{name:r,running_style:t,chara_id:s.toString(),chara_card_id:i.race_cloth_id.toString(),team:e,speed:i.speed,stamina:i.stamina,power:i.power,guts:i.guts,wit:i.wiz,aptitudes:{long:x(i.proper_distance_long),medium:x(i.proper_distance_middle),mile:x(i.proper_distance_mile),sprint:x(i.proper_distance_short),dirt:x(i.proper_ground_dirt),turf:x(i.proper_ground_turf),front:x(i.proper_running_style_nige),pace:x(i.proper_running_style_senko),late:x(i.proper_running_style_sashi),end:x(i.proper_running_style_oikomi)},skills:a}}var le=P('<div><details style="min-width: 20em" class="svelte-1teyv7f"><summary style="font-size: 2em" class="svelte-1teyv7f"><div class="svelte-1teyv7f"> <button class="svelte-1teyv7f">add all</button></div></summary>  <!></details></div>'),ue=P('<dialog class="svelte-1teyv7f"><div class="teams-list svelte-1teyv7f"><!></div></dialog>');function de(i,t){W(t,!0);let e,s=E(void 0);ie(t.trainer_id).then(u=>g(s,new ht(u),!0));function r(){e.open||t.item.resolve({selected_data:null})}ot(()=>{e?.showModal()});async function a(u){for(const m of u.umas)t.active_umas.push(await oe(m.data,m.running_style,u.distance));l(s).delete(u.distance)}const n=["","Sprint","Mile","Medium","Long","Dirt"];var o=ue(),f=d(o),h=d(f);{var b=u=>{var m=ut("loading...");M(u,m)},w=u=>{var m=Bt(),y=lt(m);st(y,17,()=>l(s).entries(),rt,(k,p)=>{var T=B(()=>jt(l(p),2));let v=()=>l(T)[0],C=()=>l(T)[1];var S=le(),L=d(S),A=d(L),j=d(A),N=d(j),F=_(N);F.__click=()=>a(C()),c(j),c(A);var O=_(A,2);st(O,17,()=>C().umas,rt,(mt,pt)=>{ne(mt,{get uma(){return l(pt).data}})}),c(L),c(S),z(()=>I(N,`${n[v()]??""} `)),M(k,S)}),M(u,m)};dt(h,u=>{l(s)?u(w,!1):u(b)})}c(f),c(o),q(o,u=>e=u,()=>e),ft(o,u=>vt?.(u)),R("clickbackdrop",o,()=>{e.close(),r()}),R("animationend",o,r),M(i,o),J()}Ut(["click"]);const be=te().addVariant("search",re).addVariant("select",de).build();export{ht as S,ft as a,qt as b,be as m};
